unit uMain;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs,
  System.ImageList, FMX.ImgList, FMX.Controls.Presentation, FMX.StdCtrls,
  FMX.Objects, FMX.TabControl, uAvatar, UObst;

type
  TfrmMain = class(TForm)
    pnlMain: TPanel;
    imgListAvt: TImageList;
    imgListObst: TImageList;
    imgListBg: TImageList;
    imgListOutros: TImageList;
    TabControl1: TTabControl;
    tabInicio: TTabItem;
    tabJogo: TTabItem;
    imgChao: TImage;
    imgBg: TImage;
    Button1: TButton;
    player: TImage;
    obst1: TImage;
    obst2: TImage;
    obst3: TImage;
    obst4: TImage;
    obst5: TImage;
    Timer1: TTimer;

    procedure carregarImagem(img: TImage; imgNome: String; imgList: TimageList; x, y, altura, largura: Integer);
    procedure FormShow(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure Timer1Timer(Sender: TObject);

  private
    //Estado Atual || 0 - Jogar | 1 - Jogando | 2 - Pausado | 3 - Perdeu ||
    FestadoAtual: Integer;
    Fvelocidade: Integer;
  public
    property velocidade: Integer read Fvelocidade write Fvelocidade;
    property estadoAtual: Integer read FestadoAtual write FestadoAtual;
  end;

var
  frmMain: TfrmMain;
  avt: TAvatar;
  obst: TObstaculos;

implementation

{$R *.fmx}

{ TForm1 }

procedure TfrmMain.Button1Click(Sender: TObject);
begin
  TabControl1.ActiveTab := tabJogo;
end;

procedure TfrmMain.carregarImagem(img: TImage; imgNome: String;
  imgList: TimageList; x, y, altura, largura: Integer);
var
  i: Integer;
  s: TSizeF;
begin
  i := imgList.Source.IndexOf(imgNome);
  s.Create(largura, altura);

  with img do
  begin
    Bitmap     := imgList.Bitmap(s, i);
    Position.X := x;
    Position.Y := y;
    height     := altura;
    width      := largura;
  end;
end;

procedure TfrmMain.FormShow(Sender: TObject);
begin
  avt  := TAvatar.Create;
  obst := TObstaculos.Create;

  ClientHeight := trunc(pnlMain.Height);
  ClientWidth  := trunc(pnlMain.Width -30);
  TabControl1.ActiveTab := tabJogo;

  carregarImagem(imgBg,'bg',imgListBg,0,0,321,700);
  carregarImagem(imgChao,'chao',imgListBg,0,321,49,700);

  estadoAtual := 0; //Estado atual = Jogar
  velocidade  :=  8;
  obst1.Tag   := -1;
  obst2.Tag   := -1;
  obst3.Tag   := -1;
  obst4.Tag   := -1;
  obst5.Tag   := -1;
end;

procedure TfrmMain.Timer1Timer(Sender: TObject);
begin
  if estadoAtual <> 2 then
  begin
    avt.atualizar;
    avt.velocidade:= avt.velocidade + avt.gravidade;
    if (player.Position.Y + player.Height) < imgChao.Position.Y then
    begin
      player.Position.Y:= player.Position.Y + avt.velocidade;
    end
    else if (player.Position.Y + player.Height) = imgChao.Position.Y then
    begin
       avt.salto:= 2;
       avt.velocidade:= 0;
    end
    else
    begin
      player.Position.Y:= imgChao.Position.Y - player.Height;
    end;
  end;
end;

end.
